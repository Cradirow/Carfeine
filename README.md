# Carfeine
IoT to prevent drowsiness drive

***

## 프로젝트 마일스톤
```
4주차 : ECG를 활용한 졸음운전 예방 관련 논문 조사
5주차 : 요구 분석 명세서와 기본 설계서 작성, 필요 재료 구입(센서, 시뮬레이터, 서적 등)
5주차 : 상세 설계서 작성, 센서 동작 실험 1, 졸음운전 판단 알고리즘 연구 및 개발 1
5주차 : 센서 동작 실험 2, 졸음운전 판단 알고리즘 연구 및 개발 2
6주차 : 센서 동작 실험 3, 졸음운전 판단 알고리즘 연구 및 개발 3
7주차 : 임상실험 및 알고리즘 수정
8주차 : 졸음운전 판단 모듈 완성, 중간 보고서 작성
9주차 : 중간점검 및 테스트
10주차 : 각 모듈 통합 - 시스템 전체 개발 1
11주차 : 각 모듈 통합 - 시스템 전체 개발 2
11주차 : 시뮬레이션 및 최종 수정
12주차 : 최종 완성 및 점검, 최종 발표
```

## 2018.09.11

```
주제를 정하기 위해 다음의 6개의 큰 주제를 선정해 교수님을 찾아뵈었다.

1. 층간 소음 예방을 위한 IoT
2. 거북목, 디스크 방지를 위한 자세 교정기구 IoT
3. 비만인 사람을 위한 식단조절 IoT
4. 졸음운전 혹은 음주운전 예방을 위한 IoT
5. 무단횡단 예방을 위한 IoT
6. 화재 경보를 효율적이고 자동적으로 할 수 있는 IoT

교수님이 핵심적으로 말씀하신 내용은 다음과 같다.
- 구현 가능한 것을 선택해라.
- 이미 존재하는 아이디어라도 직접 해보는데에 의의가 있다.
- 확정된 아이디어와 일정표, 구현하는데 필요한 지원목록을 생각해오라.

면담을 통해 내린 결론은 다음과 같다.
추가적인 회의를 통해 주제를 확정하고, 그 주제에 대해 다음과 같이 접근한다.
1. 현재 존재하는 예시를 찾아본다.
2. 존재하지 않는다면 왜 존재하지 않는지 생각해본다.
3. 실현하는데 있어 필요한 것 등을 면밀히 검토한다.
```

***

## 2018.09.15
```
주제회의를 진행하였다.
장소 : 판교 카페
회의한 내용 : 각 주제에 대해 조사한 것을 바탕으로 다음과 같이 세부적으로 검토하였다.
1. 이 주제는 어떤 방향으로 개선할 여지가 있을 것으로 보여진다.
2. 이 주제는 기존 IoT사례가 있지만, 새로운 아이디어로 접근할 수 있다.
3. 이 주제는 기존 IoT에서 더 발전시킬 수 있을 것이다.
```

***

## 2018.09.19
```
주제를 확정하고 교수님을 찾아뵈었다.
그 주제는 다음과 같다 : [졸음운전 예방을 위한 IoT]

교수님이 주로 말씀하신 내용은 다음과 같다.
- 적합 주제라고 생각한다.
- 어떤 것을 이용해서 구현할지 설계를 잘 하라.
- 시간이 생각보다 짧기 때문에 부지런히 작업하라.

면담을 통해 내린 결론은 다음과 같다.
1. 추후 회의를 통해 대략적인 계획을 세운다.
2. 무엇을 할지 알게 되었으면 무엇이 필요한지 조사한다.
```

***

## 2018.09.28
```
프로젝트 계획서와 재료조사서를 작성하였다.
핵심적인 계획은 다음과 같다. 전체 일정은 프로젝트 계획서를 참고

- 뇌파 측정을 위한 논문 사전조사 : 9월 28일부터 10월 5일
- 졸음 운전자에게 필요한 요구사항 조사 : 10월 5일부터 10월 9일
- 상세 설계서 작성 : 10월 15일부터 10월 17일
- 프로젝트 구현 코딩 : 10월 18일부터 11월 23일
- 소프트웨어 UI 개발 : 10월 25일부터 11월 9일
- 하드웨어 개발 : 11월 6일부터 11월 22일
- 시뮬레이션 : 11월 29일, 30일
```

## 2018.10.05
```
프로젝트 세부 계획서를 작성하였다.
계획서를 간단하게 요약하면 다음과 같다.

- 개요
매년 졸음운전으로 인한 고통사고가 발생하고 있으며, 인명피해가 막심하다.
이를 예방하기 위해 운전자의 생체 신호를 이용하는 방면으로 연구가 진행되고 있다.
우리가 진행할 프로젝트는 여러 생체 신호 중 심전도, 즉 EGG를 활용하고자 한다.

- 기존 연구
기존 연구는 운전자를 관측하는데 기반하여 운전자의 얼굴을 인식하는 모니터링 시스템과
운전자의 머리에 부착해 뇌파 신호를 수집하는 시스템 등이 있다.

- 기존 연구와 차이점
EGG 활용시 모니터링 시스템보다 비교적 정확하게 졸음 정도를 판단할 수 있으며,
EGG 신호는 심장 부근 뿐만 아니라 손목에서도 수집할 수 있어 번거로움이 크지 않다.
```

## 2018.10.08
```
주제와 관련 연구자료를 살펴보고, 필요한 재료를 조사하였다.
현재 조사한 내용은 아두이노에서 지원하는 ECG센서를 이용해 심박수를 체크하는 것이다.
현재 조사한 심박수 측정기는 SHIELD-EKG-EMG, SHIELD-EKGEMGPRO 등이다.

교수님과 3차 면담을 진행하였다.
교수님이 말씀하신 내용은 앞으로의 일정과 그에 따른 계획을 잘 세우라는 것이었다.
또한 필요한 자원과 재료가 있으면 언제든 말하라고 하셨다.
```

## 2018.10.15
```
아두이노를 이용해 본격적인 기초조사를 시작했다.
메인 모듈인 Arduino UNO와 PSL-iECG2(소형 2채널 심전도 및 심박 측정 모듈)를 설치하였다.
먼저 ECG 모듈을 인체에 연결한 뒤 아두이노 모니터를 통해 데이터가 정상적으로 측정되는 것을 확인하였다.

아두이노 코딩은 해당 ECG 메뉴얼에 있는 정보를 활용하였다.
측정된 데이터의 그래프는 예상했던 바와 같이 P파와 QRS파형이 나타났다.
또한 심장이 빨리 뛸 수록 간격이 좁아졌고, 느리게 뛸 수록 간격이 넓어지는 것을 확인할 수 있었다.
```

## 2018.10.20
```
ECG 그래프를 주파수별로 나누어 HF, LF 값을 확인하기 위해 퓨리에 변환을 사용하기로 하였다.
그러기 위해서는 일단 ECG 모듈에서 얻은 정보를 파이썬에서 읽을 수 있도록 세팅하는 것이 핵심이었다.

시리얼 통신을 이용해 아두이노에서 파이썬으로 정보를 보내고,
파이썬에서는 정보를 읽어 일반적인 HRV 파형을 그리는 코딩을 진행하였다.
```

## 2018.10.25
```
파이썬에서 퓨리에 변환이 제대로 진행되지 않아 MATLAB을 이용해 진행하기로 하였다.
주로 MATLAB의 기본 문법과 퓨리에 변환 라이브러리를 조사하였다.

퓨리에 변환에 대한 조사가 이루어지는 동안 중간보고 논문 초고를 작성하기 시작하였다.
지금까지 프로젝트를 진행하면서 참고한 논문을 통해 대략적인 작성 방향을 세울 수 있었다.
```

## 2018.10.28
```
MATLAB으로 퓨리에 변환을 하는 과정은 생각보다 어렵고, 오래 걸렸다.
따라서 중간 논문에서는 기본적인 ECG의 측정과 주파수에 변화에 따른 특징을 이론적으로 습득한 과정과
그 측정방법에 대해서만 서술하기로 하였다.

논문 초고가 완성되었다. 틀은 다음과 같다.
1. 서론
2. 본론
  2.1 시스템 구성
  2.2 데이터 처리 및 분석부 구성
3. 시험 및 고찰
  3.1 기초 시험
  3.2 심전도 신호 취득
  3.3 FFT를 이용한 데이터 분석
4. 결론
참고문헌
```

## 2018.11.01
```
중간 논문을 발전시키기 위해 할 일들에 대해 회의하였다.
일단 RRI를 구해서, 이를 퓨리에 변환시켜 LF와 HF의 비율을 구하기로 했다.
그러기 위해서는 RRI에 대한 기본 지식이 필요했기 때문에 이부터 조사해보기로 하였다.
```

## 2018.11.05
```
RRI를 구하기 위해서 일단 ECG값을 구해 csv파일을 만들었다.
RRI의 길이는 3분에서 5분을 기준으로 측정하기로 하였고, 이는 사용자가 측정을 시작했을 때로부터
최소 3~5분 후에 결과를 얻을 수 있다는 것을 의미한다.
```

## 2018.11.09
```
csv파일에서 RRI그래프를 구하였다.
이 과정은 R-피크 검출이라고도 알려진 ECG 신호에서 R-포인트의 정확한 위치를 찾는 방법이다.
이 점들을 사용해서 점 사이의 후속 거리, 즉 RR간격을 얻을 수 있다.
1단계 - 신호 변환 : 관심있는  기능을 최대화하는 신호를 생성한다. (여기서는 QRS신호)
2단계 - 신호의 나머지 부분과 원하는 피쳐를 분리하기 위해 임계 값을 사용한다.
```

## 2018.11.15
```
RRI로부터 FFT그래프를 구하였다.
fft는 파이썬의 라이브러리를 사용해서 쉽게 구할 수 있었다.
구한 fft 그래프는 예상과 같이 나왔으며, 일단 30초 동안 측정한 값을 주파수에 따른 세기로 나타내었다.
```

## 2018.11.20
```
구한 주파수 영역에 대한 데이터로 LF값에 해당하는 0.15~0.4 구간과 HF값에 해당하는 0.04~0.15구간을 적분계산하여 LF/HF 비율을 구하였다.
```

## 2018.11.24
```
LF/HF 비율은 운전자가 느끼는 스트레스나 노이즈 등의 이유로 개인차가 있다.
따라서 데이터 집합이 가우시안 분포를 띄는 것을 이용해 크기가 10인 데이터 리스트에 대한 중앙값을 비교 값으로 이용하였다.
해당 비교 값이 임계 값 이하일 때 졸음으로 판단하고자 하였다.
```

## 2018.11.28
```
임계값 실험을 위해 피실험자의 전날 수면 박탈로 임상실험을 진행하였다.
피실험자의 주관적 졸음정도를 0~5점으로 5분 단위로 기록하고, 이를 LF/HF 데이터와 비교해 임계값을 구했다.
총 4시간의 실험을 진행했다.
```

## 2018.11.30
```
시스템에 임계값 적용 후, 시스템이 총 3단계(3~5) 졸음 정도를 감지 후, 졸음운전을 방지하기 위해 음성 메시지 알람을 전송하도록 설정하였다.
이 때 naver의 clova ccs 시스템을 이용하고자 하였다.
```

## 2018.12.03
```
운전 영상 및 발표 자료를 준비하였다.
```
